# Backend Environment Variables Template
# Copy this file to .env and fill in your actual values

# ===== DATABASE =====
# Supabase PostgreSQL connection strings
DATABASE_URL="postgresql://user:password@host:6543/postgres?pgbouncer=true&connection_limit=1"
DIRECT_URL="postgresql://user:password@host:5432/postgres"

# ===== SUPABASE (Storage - Optional) =====
# Used for server-side storage operations (recordings, transcripts, documents).
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key
SUPABASE_STORAGE_BUCKET=recordings

# ===== SERVER =====
PORT=3001
NODE_ENV=development

# ===== JWT =====
JWT_SECRET=your-secret-key-change-in-production
JWT_EXPIRES_IN=7d

# ===== ENCRYPTION (Provider Credential Storage) =====
# 64 hex chars (32 bytes). Generate with:
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ENCRYPTION_MASTER_KEY=0000000000000000000000000000000000000000000000000000000000000000

# ===== GOOGLE GEMINI API =====
GOOGLE_GEMINI_API_KEY=your-google-gemini-api-key
GOOGLE_API_KEY=your-google-api-key
# Aliases used by some services (entity extraction, memory jobs, conversation summarizer).
# Falls back to GOOGLE_GEMINI_API_KEY / GOOGLE_API_KEY when unset.
GOOGLE_AI_API_KEY=
GEMINI_API_KEY=

# ===== AGENT FORGE (Freeform Creation) =====
# Architect (chat) - xAI (optional but recommended)
XAI_API_KEY=your-xai-api-key
# xAI model for Forge architect. Use full model ID (not aliases).
# Recommended: grok-4-1-fast-non-reasoning (fast, cost-effective)
# Alternative: grok-2-latest (legacy, slower)
XAI_ARCHITECT_MODEL=grok-4-1-fast-non-reasoning
# Optional override for xAI base URL
XAI_BASE_URL=https://api.x.ai/v1

# Compiler (backend-only) - Gemini (recommended)
# If unset, falls back to GOOGLE_GEMINI_API_KEY / GOOGLE_API_KEY
GEMINI_COMPILER_API_KEY=
# Example: gemini-3-flash (or your chosen Flash model)
GEMINI_COMPILER_MODEL=

# Forge Configuration (runtime settings)
# Model for agent compilation (default: minimax-m2:free via Routeway)
FORGE_COMPILER_MODEL=minimax-m2:free
# Base URL for compiler API (default: https://api.routeway.ai/v1)
FORGE_COMPILER_BASE_URL=https://api.routeway.ai/v1

# ===== ROUTEWAY API (Agent Compiler - REQUIRED) =====
# The AI compiler uses Routeway API with MiniMax M2 to transform prompts into agent configs
# Get your API key from: https://routeway.ai/
# This is REQUIRED for the Agent Wizard to work
ROUTEWAY_API_KEY=your-routeway-api-key
# Compilation timeout in milliseconds (default: 90000)
FORGE_COMPILATION_TIMEOUT_MS=90000
# Maximum conversation turns before suggesting wrap-up (default: 12)
FORGE_MAX_TURNS=12
# Maximum user messages to include in context (default: 10)
FORGE_MAX_USER_MESSAGES=10

# ===== OPENAI API =====
OPENAI_API_KEY=your-openai-api-key

# ===== SONIOX API (Optional) =====
SONIOX_API_KEY=your-soniox-api-key

# ===== LIVEKIT CLOUD (Complex Agents) =====
LIVEKIT_API_KEY_BOBAN=your-livekit-api-key
LIVEKIT_API_SECRET_BOBAN=your-livekit-api-secret
LIVEKIT_URL_BOBAN=wss://your-project.livekit.cloud

# ===== LIVEKIT CLOUD (Simple Agents) =====
LIVEKIT_API_KEY=your-livekit-api-key
LIVEKIT_API_SECRET=your-livekit-api-secret
LIVEKIT_WS_URL=wss://your-project.livekit.cloud

# ===== TELNYX SIP (Optional - for Human Transfer) =====
TELNYX_SIP_TRUNK_ID=your-trunk-id
TELNYX_SIP_ADDRESS=your-sip-address
TELNYX_SIP_NUMBER=your-phone-number
TELNYX_SIP_USERNAME=your-username
TELNYX_SIP_PASSWORD=your-password
TRANSFER_PHONE_NUMBER=your-transfer-number

# ===== CRM INTEGRATION (Optional) =====
MAKE_WEBHOOK_URL=your-make-webhook-url

# ===== BACKEND REPORTING (Optional) =====
BACKEND_REPORTING_URL=your-backend-reporting-url

# ===== FLY.IO DEPLOYMENT (DEPRECATED - PRD-002) =====
# Per-agent Fly.io deployment is deprecated. Vora now uses shared runtime architecture.
# FLY_API_TOKEN is no longer required for agent deployments.
# FLY_API_TOKEN=your-fly-api-token  # DEPRECATED

# ===== CORS =====
FRONTEND_URL=http://localhost:3000
# Comma-separated allowlist (preferred). Example: http://localhost:8080,http://localhost:3000
CORS_ORIGIN=http://localhost:8080

# ===== CDN (for embed widget) =====
CDN_URL=http://localhost:3000/embed
API_URL=http://localhost:3001

# ===== RATE LIMITING =====
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
# Comma-separated list of Clerk user IDs with UNLIMITED rate limits (for platform owners/testing)
RATE_LIMIT_ADMIN_USERS=

# ===== DEBUG DASHBOARD =====
DEBUG_PORT=4000

# ===== REDIS CONFIGURATION (Phase 3: Performance) =====
# Redis connection for caching and rate limiting
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Redis Cluster (optional - for production high availability)
# REDIS_CLUSTER_NODES=host1:port1,host2:port2,host3:port3

# Redis connection URL (used by background jobs: compress-conversation, entity extraction, memory pruning)
# Format: redis://user:password@host:port/db
REDIS_URL=
# Upstash Redis URL (fallback when REDIS_URL is not set)
UPSTASH_REDIS_URL=

# Upstash Redis REST API (optional)
UPSTASH_REDIS_REST_URL=
UPSTASH_REDIS_REST_TOKEN=

# Database Connection Pooling (Phase 3: Performance)
# Pool size: Environment-based (dev: 5, prod: 20, can override)
DATABASE_CONNECTION_POOL_SIZE=20
# Connection timeout: How long to wait for a connection from the pool
DATABASE_CONNECTION_TIMEOUT_MS=10000
# Query timeout: Maximum time a query can run before being cancelled
DATABASE_QUERY_TIMEOUT_MS=30000
# Idle timeout: How long an idle connection stays in the pool
DATABASE_IDLE_TIMEOUT_MS=30000
# Statement cache: Number of prepared statements to cache
DATABASE_STATEMENT_CACHE_SIZE=100

# ===== ANTHROPIC API (Optional) =====
ANTHROPIC_API_KEY=your-anthropic-api-key

# ===== VOICE TTS PROVIDERS =====
# ElevenLabs - Ultra-realistic voice synthesis
ELEVENLABS_API_KEY=your-elevenlabs-api-key

# Rime TTS - Alternative voice synthesis provider (Optional)
RIME_API_KEY=

# Google Cloud TTS - Can use API key or service account credentials
GOOGLE_CLOUD_API_KEY=your-google-cloud-api-key
# OR provide path to service account JSON file
GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json

# ===== CLERK AUTHENTICATION =====
CLERK_SECRET_KEY=your-clerk-secret-key
CLERK_PUBLISHABLE_KEY=your-clerk-publishable-key

# ===== DEMO MODE =====
# Enable demo mode for testing without authentication
DEMO_MODE=true
# Non-production only: enables API-key-based auth bootstrap for local/E2E runs.
DEMO_API_KEY=demo_e2e_key_change_me
# Optional: pin a stable demo user id instead of generating a random one at boot.
DEMO_USER_ID=test-user-local

# ===== CONNECTION STABILITY =====
# Health check intervals (in milliseconds)
HEALTH_CHECK_INTERVAL=30000
CONNECTION_TIMEOUT=30000
RETRY_ATTEMPTS=3
RETRY_DELAY=1000

# Frontend URLs (auto-added to CORS in addition to FRONTEND_URL above)
NEXT_PUBLIC_API_URL=https://vora-backend.fly.dev
VITE_API_URL=https://vora-backend.fly.dev

# Debug and monitoring
DEBUG_MODE=true
LOG_LEVEL=info

# ===== MONITORING & ALERTS (Task 3: Production Monitoring) =====
# Slack webhook for real-time alerts (optional)
# Get from: https://api.slack.com/messaging/webhooks
SLACK_WEBHOOK_URL=

# Discord webhook for real-time alerts (optional)
# Get from: Server Settings > Integrations > Webhooks
DISCORD_WEBHOOK_URL=

# Sentry error tracking (optional)
SENTRY_DSN=

# ===== PADDLE BILLING =====
# Paddle API key for server-side operations (subscriptions, minute packs)
PADDLE_API_KEY=your-paddle-api-key
# Set to 'true' to use Paddle sandbox environment for testing
PADDLE_SANDBOX=false
# Paddle webhook secret for verifying webhook signatures
PADDLE_WEBHOOK_SECRET=your-paddle-webhook-secret
# Customer portal URL (defaults to https://customer-portal.paddle.com)
PADDLE_CUSTOMER_PORTAL_URL=

# Paddle Price IDs for subscription tiers (used in webhook tier lookup)
PADDLE_STARTER_PRICE_ID=pri_starter_price_id
PADDLE_PRO_PRICE_ID=pri_pro_price_id

# Paddle Product IDs for subscription tier mapping (webhook product_id â†’ tier)
PADDLE_PRODUCT_STARTER=pro_starter
PADDLE_PRODUCT_PRO=pro_pro
PADDLE_PRODUCT_ENTERPRISE=pro_enterprise

# Paddle Minute Pack Price IDs (for purchasing call minutes)
# Keys are pack sizes: 100, 500, 1000 minutes
PADDLE_MINUTE_PACK_100_PRICE_ID=pri_minute_100
PADDLE_MINUTE_PACK_500_PRICE_ID=pri_minute_500
PADDLE_MINUTE_PACK_1000_PRICE_ID=pri_minute_1000

# ===== SENTRY RELEASE (Optional) =====
SENTRY_RELEASE=

# ===== CLERK WEBHOOKS (Optional) =====
CLERK_DOMAIN=
CLERK_WEBHOOK_SECRET=

# ===== BACKEND URLs & RUNTIME SECURITY =====
# Backend URL for internal service communication
BACKEND_URL=http://localhost:3001
AGENT_RUNTIME_URL=

# Runtime secret for Python agent workers to authenticate with backend
# Used for config pre-fetching and cache warming to reduce agent startup latency
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
RUNTIME_SECRET=vora-runtime-secret-change-in-production

# ===== ADDITIONAL LLM/AI PROVIDERS (Optional) =====
OPENROUTER_API_KEY=
AI21_API_KEY=
COHERE_API_KEY=
DEEPGRAM_API_KEY=
ASSEMBLYAI_API_KEY=
DEEPSEEK_API_KEY=
GROQ_API_KEY=
MISTRAL_API_KEY=
PERPLEXITY_API_KEY=
CARTESIA_API_KEY=
# Voyage AI embeddings (alternative to Google/OpenAI)
VOYAGE_API_KEY=

# ===== CLOUD STORAGE (Optional) =====
# AWS S3 / S3-compatible
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_REGION=
AWS_ENDPOINT=
AWS_S3_BUCKET=

# Azure Blob Storage
AZURE_STORAGE_CONNECTION_STRING=
AZURE_CONTAINER_NAME=

# Google Cloud Storage
GCS_PROJECT_ID=
GCS_BUCKET=
GCS_KEY_FILE=
GOOGLE_CLOUD_STT_CREDENTIALS=

# ===== CALENDAR INTEGRATIONS (Optional) =====
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=
OUTLOOK_CLIENT_ID=
OUTLOOK_CLIENT_SECRET=
OUTLOOK_REDIRECT_URI=
CALENDLY_CLIENT_ID=
CALENDLY_CLIENT_SECRET=
CALENDLY_REDIRECT_URI=

# ===== CRM INTEGRATIONS (Optional) =====
HUBSPOT_CLIENT_ID=
HUBSPOT_CLIENT_SECRET=
HUBSPOT_REDIRECT_URI=
HUBSPOT_WEBHOOK_SECRET=
HUBSPOT_FEATURE_ENABLED=false

SALESFORCE_CLIENT_ID=
SALESFORCE_CLIENT_SECRET=
SALESFORCE_REDIRECT_URI=

PIPEDRIVE_CLIENT_ID=
PIPEDRIVE_CLIENT_SECRET=
PIPEDRIVE_REDIRECT_URI=

ZOHO_CLIENT_ID=
ZOHO_CLIENT_SECRET=
ZOHO_REDIRECT_URI=

# ===== WHATSAPP (Optional) =====
WHATSAPP_APP_SECRET=
WHATSAPP_WEBHOOK_VERIFY_TOKEN=
# WhatsApp Cloud API credentials (for messaging integration)
WHATSAPP_ACCESS_TOKEN=
WHATSAPP_PHONE_NUMBER_ID=
WHATSAPP_BUSINESS_ACCOUNT_ID=

# ===== RECORDING STORAGE (Optional) =====
# Values typically: local|supabase|s3|gcs|azure
RECORDING_STORAGE_PROVIDER=local
RECORDING_LOCAL_PATH=./recordings
RECORDING_ENCRYPTION_KEY=
FFMPEG_PATH=

# ===== SECURITY / ENCRYPTION (Optional) =====
ENCRYPTION_KEY=
CRM_ENCRYPTION_KEY=
CRM_OAUTH_STATE_SECRET=
# MCP OAuth state signing secret (falls back to ENCRYPTION_KEY)
MCP_OAUTH_STATE_SECRET=
SIP_ENCRYPTION_KEY=

# ===== PROCESS / RUNTIME FLAGS (Optional) =====
HOST=
DEBUG=
DOTENV_CONFIG_PATH=
ENABLE_FILE_LOGGING=false
SHUTDOWN_TIMEOUT_MS=15000
SKIP_ENV_VALIDATION=false

# ===== FEATURE FLAGS (Optional) =====
# Enable semantic cache warming at startup (default: disabled)
SEMANTIC_CACHE_WARMING=false
# HyperLogLog tracking for unique visitor / attack detection (default: true)
HLL_TRACKING_ENABLED=true
# Base URL path for audio cache assets (default: /api/audio-cache)
AUDIO_CACHE_URL_BASE=/api/audio-cache
# Safety net: when false/empty, backend may attempt `prisma migrate deploy` at boot
# if critical tables are missing (helps avoid Fly readiness 502s).
DISABLE_AUTO_MIGRATE=false

# ===== TEST FLAGS (Optional) =====
ALLOW_REMOTE_TEST_DB=false
RUN_DB_TESTS=false
SKIP_DB_TESTS=false

# ===== DEPLOYMENT / ENV (Optional) =====
FLY_APP_NAME=
VERCEL_ENV=
TELNYX_PUBLIC_KEY=

# ===== STAGING COSTING (Optional) =====
STAGING_WORKER_COST_PER_HOUR=
STAGING_WORKER_TTL_HOURS=

# ===== MAINTENANCE / CLEANUP (Optional) =====
CLEANUP_ENABLED=false
CLEANUP_CRON_SCHEDULE=
CLEANUP_WARNING_THRESHOLD_MINUTES=

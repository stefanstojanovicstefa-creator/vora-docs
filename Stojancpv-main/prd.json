{
  "project": "Vora Voice Platform",
  "branchName": "ralph/audit-01-phase-1a-command-palette",
  "description": "Phase 1a: Fix Command Palette crash on Ctrl+K/Cmd+K. Root cause is framer-motion motion.button inside Radix Dialog portal causing focus-trap conflict, plus dual Escape key handlers. IMPORTANT: Code is at ventus-voice/frontend/src/ (NOT root frontend/).",
  "userStories": [
    {
      "id": "US-001",
      "title": "Replace motion.button with plain button + CSS transitions",
      "description": "As a user, I want Ctrl+K/Cmd+K to open the Command Palette without crashing, so I can use keyboard navigation.",
      "acceptanceCriteria": [
        "IMPORTANT: Code is at ventus-voice/frontend/src/ (NOT root frontend/)",
        "All motion.button elements in CommandPalette.tsx (lines 141-198) replaced with standard <button> elements",
        "Each button has className with transition-all duration-150 for hover/selection states",
        "The initial={{ opacity: 0, y: 5 }} and animate/transition props are removed (not needed)",
        "framer-motion import removed from CommandPalette.tsx (import { motion } and import { AnimatePresence } if present)",
        "Verify no other usage of motion or AnimatePresence in CommandPalette.tsx before removing import",
        "Files: ventus-voice/frontend/src/components/CommandPalette/CommandPalette.tsx",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Removed framer-motion import (motion + AnimatePresence). Replaced motion.button with plain <button>. Replaced initial/animate/transition animation props with className transition-all duration-150. Typecheck passes clean."
    },
    {
      "id": "US-002",
      "title": "Remove dual Escape key handler conflict",
      "description": "As a user, I want Escape to clear my search query first, then close the palette on second press, without conflicts between handlers.",
      "acceptanceCriteria": [
        "IMPORTANT: Code is at ventus-voice/frontend/src/ (NOT root frontend/)",
        "Remove the onEscapeKeyDown prop from DialogContent in CommandPalette.tsx (around lines 68-73)",
        "The useEffect keyboard handler in useCommandPalette.tsx (lines 320-328) remains unchanged -- it is the single source of truth for Escape handling",
        "Test: pressing Escape with query text clears the query but keeps palette open",
        "Test: pressing Escape with empty query closes the palette",
        "Do NOT modify useCommandPalette.tsx -- it is correct as-is",
        "Files: ventus-voice/frontend/src/components/CommandPalette/CommandPalette.tsx",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Removed onEscapeKeyDown prop from DialogContent (lines 67-73). useCommandPalette.tsx useEffect handler is now the single source of truth for Escape: first press clears query, second press closes palette. Typecheck passes clean."
    },
    {
      "id": "US-003",
      "title": "Add error boundary around CommandPalette",
      "description": "As a developer, I want CommandPalette to fail gracefully instead of crashing the entire app if any future regression occurs.",
      "acceptanceCriteria": [
        "IMPORTANT: Code is at ventus-voice/frontend/src/ (NOT root frontend/)",
        "In App.tsx, find where <CommandPalette /> is rendered (around line 285)",
        "Wrap it in an ErrorBoundary component with a fallback of null (palette silently fails rather than crashing app)",
        "The ErrorBoundary wraps ONLY CommandPalette, not other components",
        "If ErrorBoundary component does not exist in the project, check if there is one already in components/ -- use the existing one",
        "If no ErrorBoundary exists, create a minimal one or use a try-catch wrapper component",
        "Files: ventus-voice/frontend/src/App.tsx",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": false,
      "notes": ""
    }
  ]
}

{
  "project": "Vora Voice Platform",
  "branchName": "ralph/locally-running-dashboard-phase-1",
  "description": "Phase 1: Core Local Setup - Create unified startup script, database setup automation, comprehensive seed data, and environment preflight check for running the Vora dashboard locally. IMPORTANT: The codebase is at ventus-voice/frontend/ and ventus-voice/backend/ (NOT at project root frontend/ backend/).",
  "userStories": [
    {
      "id": "US-L01",
      "title": "Comprehensive Local Seed Script",
      "description": "As a developer, I want a seed script that populates my local database with demo data so the dashboard has content to display when running locally.",
      "acceptanceCriteria": [
        "IMPORTANT: Code is at ventus-voice/frontend/src/ and ventus-voice/backend/src/ (NOT root frontend/ or backend/)",
        "Create ventus-voice/backend/prisma/seed-local.ts that seeds the local database with demo data",
        "Use PrismaClient from @prisma/client for all database operations",
        "Define a DEMO_USER_ID constant (use process.env.DEMO_USER_ID || 'user_local_dev_demo') and DEMO_ORG_ID (use process.env.DEMO_ORG_ID || 'org_local_dev_demo')",
        "Seed 1 organization using upsert: { id: DEMO_ORG_ID, name: 'Vora Demo Workspace', clerkOrgId: 'org_demo', slug: 'demo-workspace' }",
        "Seed 1 user using upsert: { id: DEMO_USER_ID, clerkUserId: 'user_demo', email: 'demo@voicevora.com', firstName: 'Demo', lastName: 'User', organizationId: DEMO_ORG_ID }",
        "Seed 3 agents using upsert: (1) 'Customer Support Agent' (status: 'ACTIVE', description, systemPrompt, voiceProvider: 'ELEVENLABS'), (2) 'Sales Outreach Agent' (status: 'ACTIVE'), (3) 'Interview Screener' (status: 'DRAFT'). Each agent belongs to DEMO_ORG_ID and DEMO_USER_ID",
        "Seed 5 sample agent_sessions using createMany (skipDuplicates): mix of COMPLETED and FAILED statuses with realistic durations (30-180 seconds), timestamps spread over last 7 days",
        "Seed credit packs by calling the existing seed-credit-packs logic (import and call its main function, or duplicate the upsert data inline)",
        "Seed pricing data by calling the existing seed-pricing logic (import and call its main function, or duplicate the upsert data inline)",
        "All operations use upsert (not create) for idempotency - running twice produces no errors or duplicates",
        "Script has a main() function that runs all seeds in order: org -> user -> agents -> sessions -> credit packs -> pricing",
        "Script calls prisma.$disconnect() in a finally block",
        "Script logs progress: 'Seeding organizations...', 'Seeding agents...', etc. with checkmarks on completion",
        "Add 'seed:local': 'tsx prisma/seed-local.ts' to backend package.json scripts",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Created ventus-voice/backend/prisma/seed-local.ts with full local seed: org, user, 3 agents, 5 sessions (createMany/skipDuplicates), credit packs, pricing. Uses upsert for idempotency. Adapted user fields to match actual Prisma schema (name instead of firstName/lastName, orgId instead of organizationId). Sessions use endedAt+errorCount to distinguish completed/failed (no status enum in schema). Added seed:local script to package.json. Typecheck passes."
    },
    {
      "id": "US-L02",
      "title": "Database Setup Script",
      "description": "As a developer, I want npm commands that handle complete database lifecycle (create, migrate, seed) so I can set up my local database with one command.",
      "acceptanceCriteria": [
        "IMPORTANT: Code is at ventus-voice/frontend/src/ and ventus-voice/backend/src/ (NOT root frontend/ or backend/)",
        "Create ventus-voice/backend/scripts/db-setup-local.sh that orchestrates database setup",
        "Script reads DATABASE_URL from .env file (using grep or source .env)",
        "Script extracts database name from DATABASE_URL (the part after the last /)",
        "Script checks if database exists using psql (pg_isready or psql -lqt | grep dbname)",
        "If database does not exist: create it with createdb command",
        "If database already exists: print message and continue",
        "Run prisma generate (generate Prisma client)",
        "Run prisma migrate deploy (apply existing migrations, NOT prisma migrate dev)",
        "Run tsx prisma/seed-local.ts (seed local data)",
        "Handle errors at each step with clear error messages",
        "Add these scripts to backend package.json: 'db:setup-local': 'bash scripts/db-setup-local.sh', 'db:reset-local': 'bash scripts/db-reset-local.sh', 'db:seed-local': 'tsx prisma/seed-local.ts'",
        "Create ventus-voice/backend/scripts/db-reset-local.sh that drops and recreates: dropdb + createdb + migrate + seed (with a 'Are you sure?' prompt using read)",
        "Both scripts are executable (chmod +x)",
        "Scripts work on macOS with standard PostgreSQL tools",
        "Typecheck passes (no TS changes needed, but verify existing code still compiles)"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Created ventus-voice/backend/scripts/db-setup-local.sh and db-reset-local.sh. Setup script: reads DATABASE_URL from .env, extracts DB name (handles query params), checks if DB exists via psql, creates with createdb if not, runs prisma generate, prisma migrate deploy, and tsx prisma/seed-local.ts. Reset script: same flow but with confirmation prompt (read -r), drops DB first with dropdb, then recreates. Both scripts use set -euo pipefail, handle errors at each step with clear messages, and are chmod +x. Added npm scripts: db:setup-local, db:reset-local, db:seed-local to package.json. Typecheck passes (pre-existing errors only in short-term-memory.service.ts)."
    },
    {
      "id": "US-L03",
      "title": "Environment Preflight Check",
      "description": "As a developer, I want a preflight check that validates my local environment before starting, so I get clear error messages instead of cryptic crashes.",
      "acceptanceCriteria": [
        "IMPORTANT: Code is at ventus-voice/frontend/src/ and ventus-voice/backend/src/ (NOT root frontend/ or backend/)",
        "Create ventus-voice/backend/scripts/preflight-check.sh as a bash script",
        "Check Node.js version >= 20 (parse output of node -v)",
        "Check npm is available",
        "Check PostgreSQL is reachable: pg_isready -q OR docker ps | grep postgres",
        "Check backend .env file exists at ventus-voice/backend/.env",
        "Check frontend .env file exists at ventus-voice/frontend/.env",
        "Check required backend env vars are set (non-empty) in .env: DATABASE_URL, CLERK_SECRET_KEY, CLERK_PUBLISHABLE_KEY, JWT_SECRET",
        "Check required frontend env vars in .env: VITE_CLERK_PUBLISHABLE_KEY",
        "Check backend node_modules exists (suggest npm install if missing)",
        "Check frontend node_modules exists (suggest npm install if missing)",
        "Check Prisma client is generated (check for backend/node_modules/.prisma/client directory)",
        "For each failure: print RED error message with exact fix command",
        "For each success: print GREEN checkmark",
        "Exit 0 if all checks pass, exit 1 if any fail",
        "Script runs in < 3 seconds",
        "Script is executable (chmod +x)"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Created ventus-voice/backend/scripts/preflight-check.sh. Checks: Node.js >= 20 (parses node -v major version), npm available, PostgreSQL reachable (pg_isready or docker ps | grep postgres), backend .env exists, frontend .env exists, required backend env vars (DATABASE_URL, CLERK_SECRET_KEY, CLERK_PUBLISHABLE_KEY, JWT_SECRET) non-empty, required frontend env var (VITE_CLERK_PUBLISHABLE_KEY) non-empty, backend node_modules exists, frontend node_modules exists, Prisma client generated (checks node_modules/.prisma/client). RED error messages with exact fix commands, GREEN checkmarks for success. Exit 0 on all pass, exit 1 on any fail. Script is chmod +x and runs in < 3 seconds."
    },
    {
      "id": "US-L04",
      "title": "Unified Startup Script",
      "description": "As a developer, I want to run a single command from ventus-voice/ to start the entire local development environment.",
      "acceptanceCriteria": [
        "IMPORTANT: Code is at ventus-voice/frontend/src/ and ventus-voice/backend/src/ (NOT root frontend/ or backend/)",
        "Create ventus-voice/start-local.sh as a bash script",
        "Print a banner/header: 'Vora Voice Platform - Local Development'",
        "Step 1: Run preflight check (scripts/preflight-check.sh from backend dir). Exit if it fails.",
        "Step 2: Check if backend node_modules is missing -> run npm install in backend/",
        "Step 3: Check if frontend node_modules is missing -> run npm install in frontend/",
        "Step 4: Check if Prisma client is generated -> run npx prisma generate in backend/ if not",
        "Step 5: Check if PostgreSQL database exists and has tables. If no tables, run db:setup-local",
        "Step 6: Check if port 3001 is free (lsof -ti:3001). If occupied, warn and show PID",
        "Step 7: Check if port 8080 is free (lsof -ti:8080). If occupied, warn and show PID",
        "Step 8: Start backend in background: (cd backend && npm run dev) &. Store PID.",
        "Step 9: Wait for backend health check (curl -sf http://localhost:3001/health/live, retry up to 30 seconds)",
        "Step 10: Start frontend in foreground: (cd frontend && npm run dev)",
        "Trap SIGINT/SIGTERM: kill backend background process on exit",
        "Print summary: 'Frontend: http://localhost:8080' and 'Backend: http://localhost:3001'",
        "Script is executable (chmod +x)",
        "Script works when run from ventus-voice/ directory"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Created ventus-voice/start-local.sh. Step 1: runs preflight-check.sh, exits on failure. Step 2-3: checks backend/frontend node_modules, runs npm install if missing. Step 4: checks Prisma client generated, runs prisma generate if not. Step 5: checks database exists and has tables (psql count from information_schema), runs db:setup-local if empty or missing. Step 6-7: checks ports 3001 and 8080 (lsof -ti), warns with PID if occupied. Step 8: starts backend in background (npm run dev &), stores PID. Step 9: waits for backend health (curl http://localhost:3001/health/live, retry up to 30s). Step 10: starts frontend in foreground (npm run dev). Traps SIGINT/SIGTERM to kill backend PID on exit. Prints summary with URLs. Script is chmod +x, works from ventus-voice/ directory."
    },
    {
      "id": "US-L05",
      "title": "Root NPM Aliases",
      "description": "As a developer, I want npm run shortcuts from the ventus-voice/ root so I don't have to remember script paths.",
      "acceptanceCriteria": [
        "IMPORTANT: Code is at ventus-voice/frontend/src/ and ventus-voice/backend/src/ (NOT root frontend/ or backend/)",
        "Read the existing ventus-voice/package.json and add a scripts section (keep existing dependencies)",
        "Add these scripts: 'local': './start-local.sh', 'setup': 'cd backend && npm run db:setup-local', 'db:reset': 'cd backend && npm run db:reset-local', 'db:seed': 'cd backend && npm run db:seed-local', 'frontend': 'cd frontend && npm run dev', 'backend': 'cd backend && npm run dev', 'install:all': 'cd backend && npm install && cd ../frontend && npm install'",
        "Typecheck passes (no TS changes)"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    }
  ]
}
